<div class="admin-container">
  <!-- Add Slot Card -->
  <mat-card class="add-slot-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>add_circle</mat-icon>
        Add New Time Slot
      </mat-card-title>
    </mat-card-header>
    
    <mat-card-content>
      <form class="slot-form">
        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Category</mat-label>
          <mat-select [(ngModel)]="category" name="category">
            <mat-option *ngFor="let cat of categories" [value]="cat">
              {{ cat }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        
        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Start Time</mat-label>
          <input 
            matInput 
            type="datetime-local" 
            [(ngModel)]="startTime" 
            name="startTime"
            required>
        </mat-form-field>
        
        <mat-form-field appearance="fill" class="full-width">
          <mat-label>End Time</mat-label>
          <input 
            matInput 
            type="datetime-local" 
            [(ngModel)]="endTime" 
            name="endTime"
            required>
        </mat-form-field>
        
        <div class="form-actions">
          <button 
            mat-raised-button 
            color="primary" 
            (click)="addSlot()"
            [disabled]="!startTime || !endTime"
            type="button">
            <mat-icon>add</mat-icon>
            Create Slot
          </button>
          
          <button 
            mat-stroked-button 
            (click)="setToNow()"
            type="button">
            <mat-icon>schedule</mat-icon>
            Set to Now
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- All Slots View -->
  <mat-card class="slots-view-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>list</mat-icon>
        All Time Slots
      </mat-card-title>
    </mat-card-header>
    
    <mat-card-content>
      <!-- Filter Section -->
      <div class="filter-section">
        <mat-form-field appearance="fill">
          <mat-label>Filter by Category</mat-label>
          <mat-select [(ngModel)]="filterCategory" (selectionChange)="applyFilter()">
            <mat-option value="">All Categories</mat-option>
            <mat-option *ngFor="let cat of categories" [value]="cat">
              {{ cat }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        
        <button 
          mat-stroked-button 
          (click)="clearFilter()"
          *ngIf="filterCategory">
          <mat-icon>clear</mat-icon>
          Clear Filter
        </button>
      </div>

      <!-- Slots Count -->
      <div class="slots-info">
        <p>Total Slots: <strong>{{ allSlots.length }}</strong></p>
        <p>Booked: <strong>{{ getBookedCount() }}</strong></p>
        <p>Available: <strong>{{ getAvailableCount() }}</strong></p>
      </div>

      <!-- Debug info - Remove this after confirming it works -->
      <!-- <div style="background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 4px;">
        <strong>DEBUG:</strong> allSlots.length = {{ allSlots.length }}
        <br>
        <strong>First slot:</strong> {{ allSlots[0] | json }}
      </div> -->

      <!-- Table View -->
      <div class="table-container">
        <table mat-table [dataSource]="allSlots" class="slots-table" *ngIf="allSlots.length > 0">
          <!-- ID Column -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef>ID</th>
            <td mat-cell *matCellDef="let slot">{{ slot.id }}</td>
          </ng-container>

          <!-- Category Column -->
          <ng-container matColumnDef="category">
            <th mat-header-cell *matHeaderCellDef>Category</th>
            <td mat-cell *matCellDef="let slot">
              <mat-chip>{{ slot.category }}</mat-chip>
            </td>
          </ng-container>

          <!-- Start Time Column - FIXED: Changed matColumnDef to match displayedColumns -->
          <ng-container matColumnDef="start_time">
            <th mat-header-cell *matHeaderCellDef>Start Time</th>
            <td mat-cell *matCellDef="let slot">
              {{ slot.start_time | date:'MMM d, y, h:mm a' }}
            </td>
          </ng-container>

          <!-- End Time Column - FIXED: Changed matColumnDef to match displayedColumns -->
          <ng-container matColumnDef="end_time">
            <th mat-header-cell *matHeaderCellDef>End Time</th>
            <td mat-cell *matCellDef="let slot">
              {{ slot.end_time | date:'MMM d, y, h:mm a' }}
            </td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let slot">
              <mat-chip 
                [color]="slot.user_id ? 'warn' : 'primary'"
                highlighted>
                {{ getSlotStatus(slot) }}
              </mat-chip>
            </td>
          </ng-container>

          <!-- User ID Column - FIXED: Changed matColumnDef to match displayedColumns -->
          <ng-container matColumnDef="user_id">
            <th mat-header-cell *matHeaderCellDef>User ID</th>
            <td mat-cell *matCellDef="let slot">
              <span *ngIf="slot.user_id" class="user-id">
                <mat-icon>person</mat-icon>
                {{ slot.user_id }}
              </span>
              <span *ngIf="!slot.user_id" class="no-user">-</span>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr 
            mat-row 
            *matRowDef="let row; columns: displayedColumns;"
            [class.past-slot]="isPastSlot(row)">
          </tr>
        </table>

        <div *ngIf="allSlots.length === 0" class="no-data">
          <mat-icon>inbox</mat-icon>
          <p>No time slots found</p>
          <p class="hint">Create your first time slot using the form above</p>
          <p class="hint">Or check if your backend is running and returning data</p>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>